<!DOCTYPE html>
<html lang="bn" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Omega - Sentinel Mode</title>
    
    <!-- External Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;500;700&family=Orbitron:wght@700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --bs-dark: #0a0a14;
            --bs-body-bg: var(--bs-dark);
            --bs-body-color: #d0d0e0;
            --bs-border-color-translucent: rgba(199, 21, 133, 0.2);
            --card-bg: #101024;
            --accent-color: #c71585; /* MediumVioletRed */
            --glow-color: rgba(199, 21, 133, 0.5);
            --alarm-color: #dc3545;
        }
        html, body { overflow-x: hidden; }
        body { font-family: 'Noto Sans Bengali', sans-serif; background-color: var(--bs-dark); }
        .navbar { background: rgba(16, 16, 36, 0.8); backdrop-filter: blur(12px); border-bottom: 1px solid var(--bs-border-color-translucent); }
        .navbar-brand { font-family: 'Orbitron', sans-serif; font-size: 1.5rem; color: var(--accent-color); text-shadow: 0 0 10px var(--glow-color); }
        #live-clock { font-family: 'Roboto Mono', monospace; font-size: 1rem; color: var(--accent-color); }
        .nav-pills .nav-link { color: var(--bs-body-color); background-color: var(--card-bg); border: 1px solid var(--bs-border-color-translucent); margin: 0 5px; }
        .nav-pills .nav-link.active { background-color: var(--accent-color); color: white; font-weight: 700; box-shadow: 0 0 15px var(--glow-color); }
        .info-card { background-color: var(--card-bg); border: 1px solid var(--bs-border-color-translucent); border-radius: 0.75rem; margin-bottom: 1.5rem; }
        .card-header { background-color: transparent; border-bottom: 1px solid var(--bs-border-color-translucent); font-weight: 700; color: var(--accent-color); display: flex; align-items: center; }
        .card-header .bi { margin-right: 10px; }
        .tester-card { min-height: 300px; padding: 1rem; }
        .tester-card video, .tester-card canvas { width: 100%; border-radius: 0.5rem; background-color: #000; }
        #multi-touch-canvas { cursor: crosshair; }
        .accordion-item, .accordion-button { background-color: var(--card-bg); border-color: var(--bs-border-color-translucent); color: var(--bs-body-color); }
        .accordion-button:not(.collapsed) { background-color: var(--accent-color); color: white; }
        .accordion-button::after { filter: invert(1) grayscale(100%) brightness(200%); }
        .list-group-item { background-color: transparent; border-color: rgba(199, 21, 133, 0.1); font-family: 'Roboto Mono', monospace; font-size: 0.85rem; padding: 0.4rem 0.8rem; }
        .list-group-item strong { color: #a0a0c0; }
        .list-group-item .value { color: #ffffff; text-align: right; word-break: break-all; }
        .text-success { color: #28a745 !important; }
        .text-danger { color: #dc3545 !important; }
        .pre-scrollable { max-height: 400px; }
        #dead-pixel-tester { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 9999; display: none; }
        
        @keyframes alarm-flash {
            0%, 100% { background-color: var(--bs-dark); }
            50% { background-color: var(--alarm-color); }
        }
        .alarm-active {
            animation: alarm-flash 1s infinite;
        }
    </style>
</head>
<body>
    <div id="dead-pixel-tester"></div>
    <nav class="navbar sticky-top mb-4">
        <div class="container-fluid"><a class="navbar-brand"><i class="bi bi-shield-lock-fill"></i> Project Omega: Sentinel</a>
            <div class="d-flex align-items-center">
                <div id="live-clock" class="me-3"></div><button class="btn btn-outline-danger btn-sm" onclick="location.reload()"><i class="bi bi-arrow-clockwise"></i></button>
            </div>
        </div>
    </nav>
    <div class="container-fluid">
        <ul class="nav nav-pills justify-content-center mb-4" id="pills-tab" role="tablist">
            <li class="nav-item" role="presentation"><button class="nav-link active" data-bs-toggle="pill" data-bs-target="#pills-security">সিকিউরিটি সিস্টেম</button></li>
            <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#pills-testers">ইন্টারেক্টিভ পরীক্ষক</button></li>
            <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#pills-system">সিস্টেম ও হার্ডওয়্যার</button></li>
            <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#pills-browser">ব্রাউজার ও নিরাপত্তা</button></li>
        </ul>
        <div class="tab-content" id="pills-tabContent">
            <!-- Security Tab -->
            <div class="tab-pane fade show active" id="pills-security" role="tabpanel">
                <div class="row">
                    <div class="col-lg-4">
                        <div class="info-card">
                            <div class="card-header"><i class="bi bi-gear-fill"></i> কন্ট্রোল প্যানেল</div>
                            <div class="card-body text-center">
                                <h5 class="mb-3">সিস্টেম স্ট্যাটাস: <span id="system-status" class="badge bg-secondary">নিষ্ক্রিয়</span></h5>
                                <div class="btn-group w-100">
                                    <button id="arm-btn" class="btn btn-success"><i class="bi bi-shield-check"></i> সিস্টেম আর্ম করুন</button>
                                    <button id="disarm-btn" class="btn btn-danger" disabled><i class="bi bi-shield-x"></i> ডিজার্ম করুন</button>
                                </div>
                                <hr>
                                <h6>EmailJS সেটিংস</h6>
                                <div class="form-floating mb-2">
                                    <input type="text" class="form-control" id="emailjs-service-id" placeholder="Service ID">
                                    <label for="emailjs-service-id">Service ID</label>
                                </div>
                                <div class="form-floating mb-2">
                                    <input type="text" class="form-control" id="emailjs-template-id" placeholder="Template ID">
                                    <label for="emailjs-template-id">Template ID</label>
                                </div>
                                <div class="form-floating mb-2">
                                    <input type="text" class="form-control" id="emailjs-public-key" placeholder="Public Key">
                                    <label for="emailjs-public-key">Public Key</label>
                                </div>
                                <div class="form-floating mb-2">
                                    <input type="email" class="form-control" id="recipient-email" placeholder="Recipient Email">
                                    <label for="recipient-email">প্রাপকের ইমেইল</label>
                                </div>
                                <button id="save-settings-btn" class="btn btn-primary w-100">সেটিংস সেভ করুন</button>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="info-card">
                            <div class="card-header"><i class="bi bi-camera-video-fill"></i> লাইভ মনিটর</div>
                            <div class="card-body">
                                <video id="security-camera-feed" playsinline autoplay muted style="width:100%; border-radius: 0.5rem;"></video>
                                <canvas id="motion-canvas" class="d-none"></canvas>
                            </div>
                        </div>
                        <div class="info-card">
                            <div class="card-header"><i class="bi bi-image"></i> সর্বশেষ ধারণকৃত ছবি</div>
                            <div class="card-body">
                                <img id="last-capture" src="https://placehold.co/400x300/101024/c71585?text=No+Capture" alt="Last Capture" style="width:100%; border-radius:0.5rem;">
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="info-card">
                             <div class="card-header"><i class="bi bi-list-check"></i> ইভেন্ট লগ</div>
                             <div class="card-body">
                                 <ul class="list-group list-group-flush pre-scrollable" id="event-log"></ul>
                             </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="tab-pane fade" id="pills-testers" role="tabpanel">
                 <div class="row">
                    <div class="col-lg-4 col-md-6"><div class="info-card tester-card"><h5 class="card-title text-center w-100 mb-2"><i class="bi bi-hand-index-thumb"></i> মাল্টি-টাচ টেস্ট</h5><canvas id="multi-touch-canvas" height="220"></canvas></div></div>
                    <div class="col-lg-4 col-md-6"><div class="info-card tester-card"><h5 class="card-title text-center w-100 mb-2"><i class="bi bi-camera-video"></i> ক্যামেরা টেস্ট</h5><video id="camera-feed" class="mb-2" playsinline autoplay muted></video><button id="switch-camera-btn" class="btn btn-sm btn-outline-info d-none"><i class="bi bi-arrow-repeat"></i> ক্যামেরা পরিবর্তন</button></div></div>
                    <div class="col-lg-4 col-md-6"><div class="info-card tester-card"><h5 class="card-title text-center w-100 mb-2"><i class="bi bi-mic"></i> মাইক্রোফোন টেস্ট</h5><canvas id="mic-visualizer" height="220"></canvas></div></div>
                </div>
            </div>
            <div class="tab-pane fade" id="pills-system" role="tabpanel"><div class="accordion" id="system-accordion"></div></div>
            <div class="tab-pane fade" id="pills-browser" role="tabpanel"><div class="accordion" id="browser-accordion"></div></div>
            <div class="tab-pane fade" id="pills-media" role="tabpanel"><div class="accordion" id="media-accordion"></div></div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', async () => {
        const el = (id) => document.getElementById(id);
        
        // --- Security System Logic ---
        let isArmed = false;
        let lastCaptureTime = 0;
        let motionCheckInterval;
        let securityStream;
        const armBtn = el('arm-btn');
        const disarmBtn = el('disarm-btn');
        const statusBadge = el('system-status');
        const eventLog = el('event-log');
        let emailjsConfig = {};

        const logEvent = (message, type = 'info') => {
            const colors = { info: 'text-white', motion: 'text-warning', sound: 'text-warning', email: 'text-success', error: 'text-danger' };
            const icon = { info: 'bi-info-circle', motion: 'bi-person-walking', sound: 'bi-volume-up', email: 'bi-envelope', error: 'bi-exclamation-triangle' };
            eventLog.innerHTML += `<li class="list-group-item ${colors[type]}"><i class="bi ${icon[type]} me-2"></i>[${new Date().toLocaleTimeString()}] ${message}</li>`;
            eventLog.scrollTop = eventLog.scrollHeight;
        };

        const triggerAlarm = (reason) => {
            if (Date.now() - lastCaptureTime < 30000) return; // 30 second cooldown
            lastCaptureTime = Date.now();
            
            logEvent(`অনুপ্রবেশ শনাক্ত: ${reason}! অ্যালার্ম অ্যাক্টিভেটেড।`, reason.includes('Motion') ? 'motion' : 'sound');
            document.body.classList.add('alarm-active');
            new Audio('data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU'+Array(1e3).join('12111121')).play();
            
            captureAndSend(reason);

            setTimeout(() => document.body.classList.remove('alarm-active'), 5000);
        };
        
        const captureAndSend = (reason) => {
            const video = el('security-camera-feed');
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            const imageDataUrl = canvas.toDataURL('image/jpeg');
            el('last-capture').src = imageDataUrl;
            
            if (emailjsConfig.serviceId && emailjsConfig.templateId && emailjsConfig.publicKey && emailjsConfig.recipient) {
                logEvent('ইমেইল পাঠানোর চেষ্টা করা হচ্ছে...', 'info');
                const templateParams = {
                    recipient: emailjsConfig.recipient,
                    message: `Project Omega একটি ${reason} শনাক্ত করেছে।`,
                    image_data: imageDataUrl,
                };
                
                fetch('https://api.emailjs.com/api/v1.0/email/send', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        service_id: emailjsConfig.serviceId,
                        template_id: emailjsConfig.templateId,
                        user_id: emailjsConfig.publicKey,
                        template_params: templateParams,
                    }),
                })
                .then(response => response.ok ? logEvent('ছবিসহ ইমেইল সফলভাবে পাঠানো হয়েছে।', 'email') : logEvent('ইমেইল পাঠাতে ব্যর্থ।', 'error'))
                .catch(err => logEvent(`ইমেইল পাঠাতে ত্রুটি: ${err}`, 'error'));
            } else {
                logEvent('EmailJS সেটিংস সঠিক নয়। ইমেইল পাঠানো সম্ভব নয়।', 'error');
            }
        };

        el('save-settings-btn').onclick = () => {
            emailjsConfig = {
                serviceId: el('emailjs-service-id').value,
                templateId: el('emailjs-template-id').value,
                publicKey: el('emailjs-public-key').value,
                recipient: el('recipient-email').value,
            };
            localStorage.setItem('omega-emailjs-config', JSON.stringify(emailjsConfig));
            logEvent('EmailJS সেটিংস সেভ করা হয়েছে।', 'info');
        };

        const loadSettings = () => {
            const saved = localStorage.getItem('omega-emailjs-config');
            if (saved) {
                emailjsConfig = JSON.parse(saved);
                el('emailjs-service-id').value = emailjsConfig.serviceId || '';
                el('emailjs-template-id').value = emailjsConfig.templateId || '';
                el('emailjs-public-key').value = emailjsConfig.publicKey || '';
                el('recipient-email').value = emailjsConfig.recipient || '';
            }
        };
        loadSettings();

        armBtn.onclick = async () => {
            try {
                securityStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                el('security-camera-feed').srcObject = securityStream;
                isArmed = true;
                armBtn.disabled = true;
                disarmBtn.disabled = false;
                statusBadge.textContent = 'সক্রিয়';
                statusBadge.className = 'badge bg-success';
                logEvent('সিস্টেম আর্মড এবং মনিটরিং চালু হয়েছে।', 'info');

                // Motion Detection Setup
                const video = el('security-camera-feed');
                const canvas = el('motion-canvas');
                const ctx = canvas.getContext('2d', { willReadFrequently: true });
                const SCALE = 0.2;
                let oldImageData;
                
                const checkMotion = () => {
                    if (!isArmed) return;
                    canvas.width = video.videoWidth * SCALE;
                    canvas.height = video.videoHeight * SCALE;
                    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                    const newImageData = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
                    
                    if(oldImageData){
                        let diff = 0;
                        for(let i=0; i < newImageData.length; i += 4) {
                            diff += Math.abs(newImageData[i] - oldImageData[i]);
                        }
                        if(diff / newImageData.length > 1) { // Motion threshold
                             triggerAlarm("Motion");
                        }
                    }
                    oldImageData = newImageData;
                }
                motionCheckInterval = setInterval(checkMotion, 1000);

                // Sound Detection Setup
                const audioContext = new AudioContext();
                const analyser = audioContext.createAnalyser();
                const source = audioContext.createMediaStreamSource(securityStream);
                source.connect(analyser);
                analyser.fftSize = 512;
                const bufferLength = analyser.frequencyBinCount;
                const dataArray = new Uint8Array(bufferLength);
                const checkSound = () => {
                    if(!isArmed) return;
                    requestAnimationFrame(checkSound);
                    analyser.getByteFrequencyData(dataArray);
                    let sum = dataArray.reduce((a, b) => a + b, 0);
                    if (sum / dataArray.length > 50) { // Sound threshold
                        triggerAlarm("Loud Noise");
                    }
                };
                checkSound();

            } catch (err) {
                logEvent('ক্যামেরা বা মাইক্রোফোন চালু করা যায়নি।', 'error');
            }
        };

        disarmBtn.onclick = () => {
            isArmed = false;
            securityStream.getTracks().forEach(track => track.stop());
            clearInterval(motionCheckInterval);
            armBtn.disabled = false;
            disarmBtn.disabled = true;
            statusBadge.textContent = 'নিষ্ক্রিয়';
            statusBadge.className = 'badge bg-secondary';
            logEvent('সিস্টেম ডিজার্ম করা হয়েছে।', 'info');
        };

        // Other testers
        const touchCanvas = el('multi-touch-canvas');
        if(touchCanvas){
            const touchCtx = touchCanvas.getContext('2d');
            const touches = {};
            const touchColors = ['#c71585', '#00bfff', '#32cd32', '#ffc107', '#6f42c1', '#fd7e14'];
            const drawTouches = () => {
                touchCtx.clearRect(0, 0, touchCanvas.width, touchCanvas.height);
                Object.values(touches).forEach((touch, i) => {
                    touchCtx.beginPath();
                    touchCtx.arc(touch.x, touch.y, 20, 0, 2 * Math.PI, false);
                    touchCtx.fillStyle = touchColors[i % touchColors.length];
                    touchCtx.fill();
                });
            };
            touchCanvas.addEventListener('touchstart', e => { e.preventDefault(); Array.from(e.changedTouches).forEach(t => { const rect = touchCanvas.getBoundingClientRect(); touches[t.identifier] = { x: t.clientX - rect.left, y: t.clientY - rect.top }; }); drawTouches(); });
            touchCanvas.addEventListener('touchmove', e => { e.preventDefault(); Array.from(e.changedTouches).forEach(t => { const rect = touchCanvas.getBoundingClientRect(); touches[t.identifier] = { x: t.clientX - rect.left, y: t.clientY - rect.top }; }); drawTouches(); });
            touchCanvas.addEventListener('touchend', e => { e.preventDefault(); Array.from(e.changedTouches).forEach(t => delete touches[t.identifier]); drawTouches(); });
        }
    });
    </script>
</body>
</html>
